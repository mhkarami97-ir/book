---
layout: post
full-width: true
title: Software Architecture The Hard Parts
subtitle: Modern Trade-Off Analysis for Distributed Architectures
cover-img: /assets/images/software_architecture_the_hard_parts.jpg
thumbnail-img: /assets/images/software_architecture_the_hard_parts.jpg
share-img: /assets/images/software_architecture_the_hard_parts.jpg
tags: [کتاب, برنامه_نویسی, سیستم_توزیع_شده]
---

## توضیحات
هیچ تصمیم آسانی در معماری نرم افزار وجود ندارد. در عوض، بخش‌های سخت بسیاری وجود دارد؛ مشکلات یا مسائل دشواری که بهترین شیوه ای برای انجام ندارند و شما را مجبور می‌کنند تا با انجام سبک سنگین‌های مختلف، یکی را برای موفقیت انتخاب کنید. با کمک کتاب Software Architecture: The Hard Parts (معماری نرم افزار: قسمت‌های سخت)، شما یاد خواهید گرفت که چگونه به طور انتقادی در مورد سبک سنگین‌های مربوط به معماری‌های توزیع شده فکر کنید.  
پیشکسوتان معماری و مشاوران مجرب، نیل فورد، مارک ریچاردز، پرامود سادالاژ و ژامک دهقانی، درباره راهبردهای انتخاب یک معماری مناسب بحث می‌کنند. نویسندگان با سر هم کردن داستانی درباره یک گروه خیالی از متخصصان فناوری - جوخه Sysops - همه چیز را از نحوه تعیین جزئیات سرویس، مدیریت گردش کار و هماهنگ سازی، مدیریت و جداسازی قراردادها و مدیریت تراکنش‌های توزیع شده تا نحوه بهینه سازی ویژگی‌های عملیاتی، مانند مقیاس پذیری، کشش و عملکرد را مورد بررسی قرار می‌دهند.  
این کتاب با تمرکز بر سوالات متداول، تکنیک‌هایی را ارائه می‌کند که به شما کمک می‌کند تا هنگام مواجهه با مسائلی که به عنوان یک معمار با آن مواجه هستید، سبک سنگین‌ها را انجام دهید و بررسی کنید.

## نظر


## نظر
 - `امتیاز` : 09/10
 - `به دیگران توصیه می‌کنم` : بله
 - `دوباره می‌خوانم` : بله
 - `ایده برجسته` : 
 - `تاثیر در من` : 
 - `نکات مثبت` : 
 - `نکات منفی` : 

## مشخصات
 - `نویسنده` : Mark Richards, Neal Ford, Pramod Sadalage, Zhamak Dehghani
 - `انتشارات` : O'Reilly Media

## بخش‌هایی از کتاب

# فصل اول کتاب "Software Architecture: The Hard Parts"
## آنچه رخ می‌دهد وقتی "بهترین روش" وجود ندارد

### چرا معماری نرم‌افزار کار سختی است؟
در این فصل، نویسندگان با یک حقیقت اساسی شروع می‌کنند: در معماری نرم‌افزار، اغلب با مسائلی روبرو هستیم که راه‌حل قطعی و جهانی برای آنها وجود ندارد. مفاهیمی مثل “best practice” فقط تا حدی (و در بعضی فضاها) کاربرد دارند. علت آن:
- پروژه‌ها و چالش‌ها بسیار متنوع‌اند.
- انتخاب‌ها همواره وابسته به نیازهای تجاری، محدودیت‌های فنی و شرایط سازمانی است.
- راه‌حل‌هایی که در یک زمینه جواب می‌دهند، ممکن است در جای دیگر مشکل‌ساز شوند.

### هدف فصل
هدف این فصل، تعریف درست مسئله و دادن نگرش درست به مخاطب است که قرار نیست برای هر چالش معماری، یک جواب واحد وجود داشته باشد. معماری، کار تصمیم‌گیری میان گزینه‌های مختلف و یافتن بهترین راه بر اساس شرایط است.

### چرایی بخش‌های سخت معماری
– **Ambiguity و عدم قطعیت:** خیلی وقت‌ها اطلاعات ناقص یا مبهم است؛ باید با فرضیات گام برداریم و تصمیمات را مطابق تغییرات اصلاح کنیم.
– **Trade-off:** هر راه‌حلی مزایا و معایبی دارد. لازم است مصالحه (trade-off) را بشناسیم و مدیریت کنیم.
– **تعاملات انسانی:** معماری فقط تکنولوژی نیست؛ شامل سازمان، ذینفعان، تیم‌ها و فرهنگ هم هست.

### داده‌ها و اهمیت آنها در معماری
بخشی از فصل به نقش محوری داده می‌پردازد:
- معماری خوب باید از همان ابتدا به سوال “داده‌ها کجا هستند؟ چه کسی صاحب آن‌هاست؟ چگونه اعمال تغییرات و پردازش اطلاعات انجام می‌شود؟” پاسخ بدهد.
- در دوران معماری‌های توزیع‌شده (مثل میکروسرویس یا کلود)، داده‌ها تبدیل به کلیدی‌ترین چالش‌ها شده‌اند چون مالکیت داده بین سرویس‌ها تقسیم می‌شود و مسائل consistency، امنیت و کارایی اهمیت مضاعف پیدا می‌‌کند.

### سند تصمیم معماری (ADR)
نویسندگان تاکید دارند که معماری یعنی "تصمیم‌گیری". بنابراین مستندسازی تصمیمات معماری با شفافیت دلایل، الزامی است. معماری باید "قابل توضیح" و "قابل دفاع" باشد تا بتوان به تیم، ذینفعان یا حتی معماران بعدی چرایی انتخاب‌ها را منتقل کرد.

سند "Architectural Decision Record" یا مخفف آن "ADR" برای همین هدف است: ثبت موضوع تصمیم، گزینه‌های قابل بررسی، دلایل انتخاب و رد هر گزینه و اثرات تصمیم. اگر این فرآیند شفاف و مدون شود، هم یادگیری تسهیل می‌شود، هم خطاهای قبلی تکرار نمی‌شود.

#### تمرین: فکر کن اگر در یک پروژه واقعی، سرویس پرداخت دارید و باید تصمیم بگیرید که اعتبارسنجی کارت بانکی را در همان سرویس انجام دهید یا یک سرویس مستقل ایجاد کنید، چه گزینه‌هایی دارید؟ هر کدام چه مزایا و معایبی دارند؟ دلیل انتخاب نهایی چه خواهد بود؟

### Fitness Function در معماری
ایده "Fitness Function" یا توابع سنجش کارایی/سلامت معماری، از یادگیری ماشین گرفته شده است. مشابه زمانی‌که یک معیار (function) داریم تا بفهمیم مدل یادگیری چقدر خوب کار می‌کند، در معماری هم باید معیارهایی داشته باشیم که به‌صورت اتوماتیک یا دستی، کیفیت تصمیمات و ساختار را ارزیابی کند.

مثال‌ها:
- هیچ سرویسی نباید به بیش از سه سرویس دیگر وابسته باشد.
- نرخ خطای ارتباطات سرویس‌ها باید زیر 0.5٪ بماند.
- دیتابیس‌ها باید فقط توسط سرویس‌های مشخص خودش قابل دسترسی باشند.

#### سوال: آیا تا به حال قانونی (تست یا مانیتورینگ) برای سلامت معماری تعریف کرده‌ای؟ مثلاً در مانیتورینگ‌هایتان چه چیزی را به عنوان "نشانه معماری سالم" می‌شناسید؟

### تفاوت معماری و طراحی
این بخش تمایز بین **معماری** (تصمیمات ساختاری سطح بالا، غیرقابل تغییر یا خیلی سخت قابل تغییر) و **طراحی** (جزئیات پیاده‌سازی، الگوها و ترکیب‌ها) را شرح می‌دهد.
- معماری چیزی است که اگر اشتباه شود، هزینه اصلاح آن بالا است.
- طراحی معمولاً جزئی‌تر است و اصلاحش کم‌هزینه‌تر.

### معرفی مطالعه موردی: Sysops Squad
نویسندگان برای ملموس کردن مباحث از مثال یک پروژه تخیلی به نام "Sysops Squad" استفاده می‌کنند و تصمیمات معماری آن را طی فصل‌ها بررسی می‌کنند تا مفاهیم نه صرفاً تئوری بلکه عملی و واقعی تدریس شوند.

***

## خلاصه فصل اول (برای تثبیت)
- در معماری نرم‌افزار، جواب قطعی وجود ندارد؛ تصمیمات همیشه trade-off دارند.
- داده‌ها و مالکیت آنها مرکز ثقل معماری توزیع‌شده هستند.
- مستندسازی تصمیمات با ADR الزامی است.
- تعریف Fitness Function برای سلامت معماری اهمیت دارد.
- مرز واضح بین معماری و طراحی را باید بشناسیم.
- مثال پروژه واقعی، مسیر یادگیری را عملی‌تر می‌کند.

***

### بررسی درک 
- **سئوال:** معمار نرم‌افزار چه زمانی به سراغ سند ADR می‌رود و قرار است چه موضوعاتی را در آن ثبت کند؟
- اگر دوست داری بیشتر با ADR یا Fitness Function کار کنیم یا مثالی برای هرکدام بزنم، بگو تا با هم تمرین کنیم.

## توضیح عمیق و مثالی از ADR (Architectural Decision Record)

### تعریف کامل‌تر
ADR ابزاری ساختاریافته برای ثبت و تحلیل تصمیمات معماری است. این سند، نه تنها انتخاب انجام‌شده، بلکه دلایل، شرایط، گزینه‌های جایگزین و پیامدها را (کامل و با صراحت) مستند می‌کند. کاربردش این است که هر معمار، مدیر یا دولوپری در آینده بتواند منطق تصمیمات را درک کند و اگر نیاز به تغییر بود، آن را آگاهانه و اصولی انجام دهد.

### ساختار استاندارد ADR

معمولاً هر ADR شامل چهار بخش کلیدی است:
1. **عنوان (Title):** موضوع تصمیم معماری، به‌صورت خلاصه.
2. **زمینه (Context):** توضیح شرایط و مشکل/فرصت، به‌همراه گزینه‌های جایگزین.
3. **تصمیم (Decision):** شرح تصمیم گرفته‌شده و علت ارجحیت آن.
4. **پیامدها (Consequences):** اثرات مثبت/منفی تصمیم و trade-offها.

***

### مثال واقعی ۱: ADR برای سرویس پرداخت

**عنوان:** جداسازی اعتبارسنجی کارت بانکی به سرویس مستقل

**زمینه:**  
پرداخت کاربران باید بلافاصله تأیید شود تا تجربه کاربری مناسب باشد. دو گزینه وجود دارد:
- انجام اعتبارسنجی در همان سرویس خرید
- جدا کردن اعتبارسنجی به یک سرویس مستقل
در صورت استقلال، مزیت دیپلوی مستقل و تحمل خطا داریم، اما لَتِنسی و پیچیدگی افزایش می‌یابد.

**تصمیم:**  
اعتبارسنجی کارت بانکی به‌‌عنوان یک سرویس مستقل پیاده‌سازی می‌شود. این سرویس نسخه‌بندی‌شده و مستقل از چک‌آوت عمل می‌کند.

**پیامدها:**  
- مزیت: دیپلوی مجزا، تحمل بالاتر به خطاهای بانکی، تسهیل تغییر بانک‌های ارائه‌دهنده API.
- عیب: افزایش لَتِنسی (رفت‌وبرگشت شبکه)، احتمال خطا در ارتباطات، پیچیدگی بیشتر مانیتورینگ مسیر سرویس‌ها.

***

### مثال واقعی ۲: ADR از متن کتاب (Sysops Squad)

**عنوان:** یکپارچگی سرویس مدیریت مشتری

**زمینه:**  
کاربر برای ثبت‌نام باید اطلاعات پروفایل، کارت، پسورد و محصولات را درج کند. سه گزینه:
- تجمیع همه قابلیت‌ها در یک سرویس (یکپارچگی)
- جداسازی بر اساس نوع داده (حساس/غیرحساس)
- جداسازی هر قابلیت به سرویس مستقل

**تصمیم:**  
یک سرویس یکپارچه ساخته می‌شود تا ضمن حفظ تراکنش اتمیک و ACID، انجام عملیات ثبت‌نام سریع و پایدار باشد. امنیت داده‌های حساس از طریق لایه امنیتی ابزار Tortoise و Service Mesh انجام می‌شود.

**پیامدها:**  
- مزیت: انجام عملیات ثبت‌نام در یک transaction، سهولت اطمینان از یکپارچگی داده.
- عیب: در صورت ضعف امنیتی، داده‌های حساس آسیب‌پذیرتر می‌شود؛ وابستگی بیشتر کدها.

***

## توضیح عمیق‌تر درباره Fitness Function

### فلسفه Fitness Function
در معماری و DevOps هدف این است که سلامت و تطابق ساختار معماری با اهداف تجاری یا تکنیکی به شیوه‌ای *قابل سنجش* و *اتوماتیک* بررسی شود. Fitness Function قاعده‌ای نرم‌افزاری (کد، تست، هشدار، پابنده، یا مانیتورینگ) است که به صورت پیوسته یکی از ویژگی‌های اصلی معماری را اندازه‌گیری می‌کند و اگر سازگاری مختل شد، هشدار یا خطا می‌دهد.

### دسته‌بندی
- **اتمی:** بررسی صرفاً یک معیار (مثلاً عدم وابستگی سیکلی بین ماژول‌ها)
- **کل‌نگر:** ترکیب چند ویژگی (مثلاً حفظ تعادل بین امنیت و کارایی)

***

### مثال Fitness Function اتمی (کد جاوا-سی‌شارپ)

**بررسی ضد-وابستگی سیکلی**
فرض کنیــد می‌خواهیم مطمئن شویم که هیچ cyclic dependency بین ماژول‌ها وجود ندارد. می‌توان از ابزارهایی مثل [NDepend] برای #C یا [JDepend] برای جاوا استفاده کرد.

```csharp
// با استفاده از NDepend در دات‌نت:
warnif count > 0 from t in Application.Types
where t.IsUsing(t) // چک کردن dependency بر روی خودش یا دیگر ماژول‌های یکسان
select t
```
این خط کد، گزارشی می‌دهد تا هر circular dependency دیده شد، تیم dev هشدار بگیرد.

***

### مثال Fitness Function کاربردی (سفارشی برای سلامت ارتباطات میکروسرویس‌ها)

**سلامت تعداد وابستگی‌های سرویس**
در سازمانی توافق شده هیچ سرویسی نباید به بیش از ۳ سرویس دیگر وابسته باشد (health of independence):
```yaml
# pseudo-code:
for each service in all_services:
    if service.dependencies.count > 3:
        alert("Service {service.name} has too many dependencies")
```
این اسکریپت می‌تواند در pipeline CI/CD یا مانیتورینگ اجرا شود.

***

### مثال پیشرفته: تست performance دوره‌ای (holistic)

فرض کنید تیم شما باید تضمین کند که response time برای endpoint خاص، همیشه زیر ۵۰۰ms باشد.
- یک تست performance اتوماتیک در pipeline اجرا می‌کند اگر:
    - میانگین پاسخ بالاتر از عدد threshold باشد، build fail شود.
    - (در تست) مصرف منابع کل cluster را در بازه شلوغی هم بررسی کند.

***

### مرور و نکاتی عملی:

- **ADR**: هر زمان تصمیم معماری جدی می‌گیرید یا الگوی جدیدی پیاده می‌کنید، همین ساختار را مستند کنید؛ حتی اگر اول کار ساده‌تر بنویسید و بعداً کامل‌تر کنید.
- **Fitness Function**: سعی کن برای هر اصل معماری که برات اهمیت حیاتی دارد، یک تست اتوماتیک یا مانیتورینگ قرار دهی تا هر نوع deviation بلافاصله قابل تشخیص باشد.

---
---

